library(taxize)
rm(list=ls())
# --- load packages --- #
library(tidyverse)
# --- import data --- #
mammal_raw <-
readxl::read_xlsx("data/RNAvirus_Mammals_newJan2023/excel_with_alldata_unfiltered/RNAviruses-Mammals-RNA-newJan2023.xlsx")
unique(mammal_raw$host_taxon)
unique(mammal_raw$host_taxid)
suppressMessages(tax_name(unique(mammal_raw$host_taxid), get = 'Order', db = 'ncbi',messages = FALSE)$Order)
suppressMessages(tax_name(as.character(unique(mammal_raw$host_taxid)), get = 'Order', db = 'ncbi',messages = FALSE)$Order)
suppressMessages(tax_name(as.character(unique(mammal_raw$host_taxid)[1:10]), get = 'Order', db = 'ncbi',messages = FALSE)$Order)
install.packages("taxa")
(ncbi <- taxon_database(
name = "ncbi",
url = "http://www.ncbi.nlm.nih.gov/taxonomy",
description = "NCBI Taxonomy Database",
id_regex = "*"
))
library(taxa)
(ncbi <- taxon_database(
name = "ncbi",
url = "http://www.ncbi.nlm.nih.gov/taxonomy",
description = "NCBI Taxonomy Database",
id_regex = "*"
))
?taxon_database
# Install and load necessary packages
install.packages("data.table")
library(data.table)
# Define the directory path
dir_path <- "/home/sergej/Downloads/new_taxdump (2)"
# List all .dmp files in the directory
file_list <- list.files(path = dir_path, pattern = "\\.dmp$", full.names = TRUE)
# Initialize an empty list to store the data
dmp_data_list <- list()
# Loop through each file and read it into R
for (file in file_list) {
# Extract the base name of the file to use as the list element name
file_name <- basename(file)
file_name <- sub("\\.dmp$", "", file_name)
# Read the file and store it in the list
dmp_data_list[[file_name]] <- fread(file)
}
# Optionally, inspect the imported data
names(dmp_data_list)  # List the names of the imported datasets
head(dmp_data_list[[1]])  # Inspect the first few rows of the first dataset
install.packages("data.table")
# Define the directory path
dir_path <- "/home/sergej/Downloads/new_taxdump (2)"
# List all .dmp files in the directory
file_list <- list.files(path = dir_path, pattern = "\\.dmp$", full.names = TRUE)
# Initialize an empty list to store the data
dmp_data_list <- list()
for (file in file_list) {
# Extract the base name of the file to use as the list element name
file_name <- basename(file)
file_name <- sub("\\.dmp$", "", file_name)
# Read the file and store it in the list
dmp_data_list[[file_name]] <- fread(file)
}
# Loop through each file and read it into R with adjusted parameters
for (file in file_list) {
# Extract the base name of the file to use as the list element name
file_name <- basename(file)
file_name <- sub("\\.dmp$", "", file_name)
# Read the file and store it in the list
dmp_data_list[[file_name]] <- fread(file, fill = TRUE, quote = "", comment.char = "")
}
# Loop through each file and read it into R with adjusted parameters
for (file in file_list) {
# Extract the base name of the file to use as the list element name
file_name <- basename(file)
file_name <- sub("\\.dmp$", "", file_name)
# Read the file and store it in the list
dmp_data_list[[file_name]] <- fread(file, fill = TRUE, quote = "")
}
View(dmp_data_list)
dmp_data_list[["citations"]]
names_file <- "/home/sergej/Downloads/new_taxdump (2)/names.dmp"
nodes_file <- "/home/sergej/Downloads/new_taxdump (2)/nodes.dmp"
# Read the names and nodes files
names_data <- fread(names_file, fill = TRUE, quote = "", comment.char = "", sep = "|", strip.white = TRUE)
names_file <- "/home/sergej/Downloads/new_taxdump (2)/names.dmp"
nodes_file <- "/home/sergej/Downloads/new_taxdump (2)/nodes.dmp"
# Read the names and nodes files
names_data <- fread(names_file, fill = TRUE, quote = "", sep = "|", strip.white = TRUE)
nodes_data <- fread(nodes_file, fill = TRUE, quote = "", sep = "|", strip.white = TRUE)
# Inspect the data structures
head(names_data)
head(nodes_data)
View(names_data)
names_data <- names_data[, .(tax_id = V1, name_txt = V2, unique_name = V3, name_class = V7)]
View(nodes_data)
library(rentrez)
# Define a function to get taxonomic data for a given taxon ID
get_taxonomic_data <- function(taxon_id) {
taxon_info <- entrez_summary(db = "taxonomy", id = taxon_id)
return(taxon_info)
}
# Example taxon IDs for a few species
taxon_ids <- c("9606", "10090", "7227")  # Human, Mouse, Fruit fly
# Get taxonomic data for each taxon ID
taxonomic_data <- lapply(taxon_ids, get_taxonomic_data)
# Inspect the taxonomic data
taxonomic_data
# Function to extract species, class, and order from taxonomic data
extract_taxonomy_info <- function(taxon_info) {
taxon_lineage <- taxon_info$lineage
species <- taxon_info$scientificname
class <- NA
order <- NA
if ("class" %in% names(taxon_lineage)) {
class <- taxon_lineage[["class"]]
}
if ("order" %in% names(taxon_lineage)) {
order <- taxon_lineage[["order"]]
}
return(list(species = species, class = class, order = order))
}
# Extract taxonomy info for each taxon
taxonomy_list <- lapply(taxonomic_data, extract_taxonomy_info)
# Convert the list to a data frame
taxonomy_df <- do.call(rbind, lapply(taxonomy_list, as.data.frame))
# Inspect the resulting data frame
print(taxonomy_df)
View(taxonomic_data)
taxonomic_data[[1]]
# Function to retrieve all taxonomy IDs
get_all_taxon_ids <- function() {
# Initial search to get the count of all records
search_results <- entrez_search(db = "taxonomy", term = "all[filter]", retmax = 0)
count <- search_results$count
# Retrieve all IDs in chunks
all_taxon_ids <- c()
batch_size <- 10000  # Adjust batch size as needed
for (start in seq(0, count, by = batch_size)) {
search_results <- entrez_search(db = "taxonomy", term = "all[filter]", retstart = start, retmax = batch_size)
all_taxon_ids <- c(all_taxon_ids, search_results$ids)
Sys.sleep(1)  # To comply with NCBI rate limits
}
return(all_taxon_ids)
}
# Retrieve all taxonomy IDs
all_taxon_ids <- get_all_taxon_ids()
library(Virusparies)
?VhgBoxplot
1e-3
# Load necessary library
library(dplyr)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/taubert"
# Recursively find all virushunter.tsv files
tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
tsv_files
library(Virusparies)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- bind_rows(data_list)
View(combined_df)
# Save the combined data frame to a new file
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/combined_virushunter.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
data_list
tsv_files
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/taubert"
# Recursively find all virushunter.tsv files
tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- bind_rows(data_list)
# Combine all data frames into one using row binding
combined_df <- bind_rows(data_list)
rlang::last_trace()
tsv_files
# Combine all data frames into one using row binding
combined_df <- rbind(data_list)
View(combined_df)
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/taubert"
# Recursively find all virushunter.tsv files
tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- rbind(data_list)
View(combined_df)
# Combine all data frames into one using row binding
combined_df <- rbind(unlist(data_list))
View(combined_df)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/taubert"
# Recursively find all virushunter.tsv files
tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- do.call(rbind,data_list)
View(combined_df)
# Save the combined data frame to a new file
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/combined_virushunter.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/smalldna/taubert"
# Recursively find all virushunter.tsv files
tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- do.call(rbind,data_list)
# Save the combined data frame to a new file
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/smalldna/combined_virushunter.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
View(combined_df)
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/taubert"
# Recursively find all virushunter.tsv files
tsv_files <- list.files(path = root_dir, pattern = "virusgatherer-cap3.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- do.call(rbind,data_list)
# Save the combined data frame to a new file
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/combined_virusgatherer-cap3.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
tsv_files
basename(dirname(dirname(file)))
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/taubert"
# Recursively find all virushunter.tsv files
tsv_files <- list.files(path = root_dir, pattern = "virusgatherer-cap3.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
# Extract the folder name from the file path
folder_name <- basename(dirname(dirname(file)))
# Add the folder name as a new column
df <- df %>%
mutate(folder = folder_name)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- do.call(rbind,data_list)
# Save the combined data frame to a new file
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/combined_virusgatherer-cap3.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/taubert"
# Recursively find all virushunter.tsv files
# tsv_files <- list.files(path = root_dir, pattern = "virusgatherer-cap3.tsv", recursive = TRUE, full.names = TRUE)
tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
# Extract the folder name from the file path
folder_name <- basename(dirname(dirname(file)))
# Add the folder name as a new column
df <- df %>%
mutate(folder = folder_name)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- do.call(rbind,data_list)
# Save the combined data frame to a new file
# write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/combined_virusgatherer-cap3.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/combined_virushunter.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/taubert"
# Recursively find all virushunter.tsv files
# tsv_files <- list.files(path = root_dir, pattern = "virusgatherer-cap3.tsv", recursive = TRUE, full.names = TRUE)
tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
# Extract the folder name from the file path
folder_name <- basename(dirname(dirname(file)))
# Add the folder name as a new column
df <- df %>%
mutate(folder = folder_name)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- do.call(rbind,data_list)
# Save the combined data frame to a new file
# write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/largedna/combined_virusgatherer-cap3.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/combined_virushunter.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/taubert"
# Recursively find all virushunter.tsv files
tsv_files <- list.files(path = root_dir, pattern = "virusgatherer-cap3.tsv", recursive = TRUE, full.names = TRUE)
# tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
# Extract the folder name from the file path
folder_name <- basename(dirname(dirname(file)))
# Add the folder name as a new column
df <- df %>%
mutate(folder = folder_name)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- do.call(rbind,data_list)
# Save the combined data frame to a new file
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/combined_virusgatherer-cap3.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/combined_virushunter.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/smalldna/taubert"
# Recursively find all virushunter.tsv files
tsv_files <- list.files(path = root_dir, pattern = "virusgatherer-cap3.tsv", recursive = TRUE, full.names = TRUE)
# tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
# Extract the folder name from the file path
folder_name <- basename(dirname(dirname(file)))
# Add the folder name as a new column
df <- df %>%
mutate(folder = folder_name)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- do.call(rbind,data_list)
# Save the combined data frame to a new file
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/smalldna/combined_virusgatherer-cap3.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/rnavirus/combined_virushunter.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
# Load necessary library
library(dplyr)
library(Virusparies)
# Define the path to the root directory
root_dir <- "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/smalldna/taubert"
# Recursively find all virushunter.tsv files
# tsv_files <- list.files(path = root_dir, pattern = "virusgatherer-cap3.tsv", recursive = TRUE, full.names = TRUE)
tsv_files <- list.files(path = root_dir, pattern = "virushunter.tsv", recursive = TRUE, full.names = TRUE)
# Initialize an empty list to store the data frames
data_list <- list()
# Loop through each file and read it into a data frame, then add to the list
for (file in tsv_files) {
df <- ImportVirusTable(file)
# Extract the folder name from the file path
folder_name <- basename(dirname(dirname(file)))
# Add the folder name as a new column
df <- df %>%
mutate(folder = folder_name)
data_list <- append(data_list, list(df))
}
# Combine all data frames into one using row binding
combined_df <- do.call(rbind,data_list)
# Save the combined data frame to a new file
# write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/smalldna/combined_virusgatherer-cap3.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
write.table(combined_df, file = "/media/sergej/EXTERNAL_US/git_clone/RscriptsMasterthesis/data/hittables_taubert/smalldna/combined_virushunter.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
# Print a message indicating completion
cat("Combined file saved as combined_virushunter.tsv")
